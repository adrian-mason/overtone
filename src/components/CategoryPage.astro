---
import BaseLayout from "../layouts/BaseLayout.astro";
import CategoryIcon from "./CategoryIcon.astro";
import ArticleSearch from "./ArticleSearch.tsx";
import type { CategoryConfig } from "../lib/categories";

interface ArticleEntry {
  id: string;
  data: {
    title: string;
    description: string;
    date: Date;
    featured: boolean;
    tags: string[];
  };
}

interface Props {
  category: CategoryConfig;
  articles: ArticleEntry[];
}

const { category, articles } = Astro.props;

const sortedArticles = [...articles].sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const serializedArticles = sortedArticles.map((a) => ({
  id: a.id,
  title: a.data.title,
  description: a.data.description,
  date: a.data.date.toISOString(),
  featured: a.data.featured,
  tags: a.data.tags,
}));
---

<BaseLayout title={`${category.title} â€” Overtone`} description={category.description}>
  <div
    class="min-h-screen"
    style={`background-color: ${category.bgColor};`}
  >
    {/* Dot grid overlay */}
    <div class="dot-grid pointer-events-none fixed inset-0"></div>

    <div class="relative z-10 mx-auto max-w-5xl p-8 space-y-8">
      {/* Back link */}
      <a
        href="/#paths"
        class="inline-flex items-center gap-2 text-xl hover:underline"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7" /><path d="M19 12H5" /></svg>
        Back to Interests
      </a>

      {/* Header */}
      <div class="flex items-center gap-4">
        <CategoryIcon category={category.collection} class="h-12 w-12" style={`color: ${category.iconColor};`} />
        <h1 class="text-5xl font-bold md:text-7xl">
          {category.title}
        </h1>
      </div>
      <div class="text-2xl text-gray-600">
        {category.description}
      </div>

      {/* Search + Article List (React island) */}
      <ArticleSearch
        client:load
        articles={serializedArticles}
        categorySlug={category.slug}
        featuredBg={category.featuredBg}
        hoverColor={category.hoverColor}
      />
    </div>
  </div>
</BaseLayout>
